<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📚 나의 콘텐츠 다이어리</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }

        body{
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        #page-wrapper1{
            max-width: 53.7rem;
            margin: 1rem auto;
            padding: 0.6rem;
            background: white;
            border-radius: 1.2rem;
            box-shadow: 0px 2px 6px rgba(100, 100, 100, 0.3);
        }

        #page-wrapper2{
            max-width: 48rem;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border: 0.17rem solid #e9ecef;
            border-radius: 1rem;
        }

        #page-wrapper3{
            max-width: 48rem;
            margin: 1.5rem auto;
            padding: 1.6rem;
            background: #e3f2fd;
            border: none;
            border-radius: 0.7rem;
        }

        h1{
            text-align: center;
            font-size: 2.5rem;
            margin-top: 1.5rem;
        }

        .fx{
            display: flex;
            align-items: center;
            gap: 1.7rem;
        }

        .fx2{
            display: flex;
            align-items: center;
        }

        .fx, .fx2{
            margin-bottom: 1rem;
        }

        .fx input, select, textarea{
            flex: 1;
            font-size: 1rem;
            padding: 0.8rem;
            border: 0.15rem solid #dee2e6;
            border-radius: 0.5rem;
        }

        #plus{
            font-size: 1rem;
            color: white;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 100%;
            margin-top: 0.9rem;
            border: none;
            padding: 0.8rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #plus:hover{
            transform: translateY(-2px);
            box-shadow: 0 0.01rem 1.5rem rgba(102, 126, 234, 0.4);
        }

        .page-box1{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            text-align: center;
        }

        .page-box2{
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.2rem 0.4rem rgba(0, 0, 0, 0.1);
        }

        .num{
            font-size: 2rem;
            font-weight: bold;
            color: #667eea
        }

        .num-text{
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        #btn-all{
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .btn.frist, .btn:hover{
            background-color: #667eea;
            color: white;
        }

        .btn{
            background-color: white;
            color: #667eea;
            border: 0.15rem solid #667eea;
            padding: 0.4rem 0.8rem;
            border-radius: 2rem;
            cursor: pointer;
            margin: 0 0.3rem;
            transition: all 0.3s ease;
        }

        .delete-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0.2rem 0.4rem;
            margin-left: 0.5rem;
        }

        #line{
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.7rem;
            border-bottom: 0.15rem solid #f0f0f0;
        }

        .star{
            cursor: pointer;
            font-size: 1.3rem;
        }

        .fx3{
                display: flex;
                justify-content: space-between;
            }

        @media (max-width: 768px) {
            #page-wrapper1,
            #page-wrapper2,
            #page-wrapper3 {
                width: 95%;
                max-width: none; 
                padding: 1rem;
                margin: 1rem auto;
                box-sizing: border-box;
            }

            h1 {
                font-size: 1.8rem;
            }

            .fx {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .fx input,
            .fx select,
            .fx textarea {
                width: 100%;
                box-sizing: border-box;
            }

            #btn-all .btn {
                margin-bottom: 0.5rem;
            }

            .page-box1 {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="page-wrapper1">
        <h1 style="color: #333;">📚 나의 콘텐츠 다이어리</h1>
        <div id="page-wrapper2">
            <form id="diary-form">
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">제목:</div> <input type="text" placeholder="영화, 드라마, 웹툰 ,책 제목을 입력하세요" required>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">종류:</div>
                    <select name="" id="" required>
                        <option value="">선택하세요</option>
                        <option value="movie">🎬 영화</option>
                        <option value="drama">📺 드라마</option>
                        <option value="webtoon">📱 웹툰</option>
                        <option value="book">📖 책</option>
                    </select>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">날짜:</div> <input type="date" id="dt" required>
                </div>
                <div class="fx2">
                    <div style="margin-right: 3.7rem; font-weight: bold; color: #495057;">평점:</div>
                    <div class="star-rating">
                        <span class="star" data-rating="1">☆</span>
                        <span class="star" data-rating="2">☆</span>
                        <span class="star" data-rating="3">☆</span>
                        <span class="star" data-rating="4">☆</span>
                        <span class="star" data-rating="5">☆</span>
                        <span id="rating-text">(평점을 선택하세요)</span>
                    </div>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">메모:</div> <textarea name="" id="" placeholder="감상평이나 기억하고 싶은 내용을 적어보세요..." style="height: 3rem;"></textarea>
                </div>
                <input type="submit" id="plus" value="📝 다이어리 추가하기">
            </form>
        </div>
        <div id="page-wrapper3">
            <h3 style="text-align: center; margin-bottom: 1.2rem;">📊 나의 콘텐츠 통계</h3>
            <div class="page-box1">
                <div class="page-box2">
                    <div class="num">0</div>
                    <div class="num-text">총 개수</div>
                </div>
                <div class="page-box2">
                    <div class="num">0.0</div>
                    <div class="num-text">평균 평점</div>
                </div>
                <div class="page-box2">
                    <div class="num">0</div>
                    <div class="num-text">이번 달</div>
                </div>
                <div class="page-box2">
                    <div class="num">-</div>
                    <div class="num-text">최애 장르</div>
                </div>
            </div>
        </div>
        <div id="btn-all">
            <button class="btn frist">전체</button>
            <button class="btn">🎬 영화</button>
            <button class="btn">📺 드라마</button>
            <button class="btn">📱 웹툰</button>
            <button class="btn">📖 책</button>
        </div>
        <div style="margin-left: 1rem; margin-right: 1rem; margin-bottom: 1rem;">
            <h3 id="line">📖 내가 본 콘텐츠들</h3>
            <div id="empty" style="text-align: center; font-size: 1rem;">
                <div style="font-size: 3rem;">📝</div>
                <p>아직 기록된 콘텐츠가 없어요!</p>
                <p>위에서 첫 번째 다이어리를 작성해보세요 😊</p>
            </div>
            <div id="diary-list"></div>
        </div>
    </div>

    <script>
        document.getElementById("dt").valueAsDate = new Date();

        let selectedRating = 0;

        const stars = document.querySelectorAll(".star");

        stars.forEach(star => {
            star.addEventListener("click", function () {
                selectedRating = parseInt(this.dataset.rating);
                updateStarDisplay();
            });
        });

        function updateStarDisplay() {
            const ratingText = document.getElementById("rating-text");

            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.textContent = "★";
                } 
                else {
                    star.textContent = "☆";
                }
            });

            ratingText.textContent = selectedRating > 0
                ? `(${selectedRating}점)`
                : "(평점을 선택하세요)";
        }

        function diary(e){
            e.preventDefault();

            const title = document.querySelector("input[type='text']").value;
            const typeText = document.querySelector("select").options[
                document.querySelector("select").selectedIndex
            ].text;
            const date = document.querySelector("input[type='date']").value;
            const memo = document.querySelector("textarea").value;

            if (!title || !typeText || !date || selectedRating === 0) {
                alert("평점을 입력해주세요")
                return;
            }

            const diaryList = document.getElementById("diary-list");
            const emptyMessage = document.getElementById("empty");

            if (emptyMessage && diaryList.children.length === 0) {
                emptyMessage.style.display = "none";
            }
            
            const container = document.getElementById("diary-list");

            const main = document.createElement("div");
            main.className = "fx3";
            main.setAttribute("data-name", typeText);
            main.innerHTML = `
                <div>
                    <strong>${typeText}</strong> ${title} (${date})<br>
                    평점: ${"★".repeat(selectedRating)}${"☆".repeat(5 - selectedRating)}<br>
                    메모: ${memo || "(없음)"}
                </div>
                <button class="delete-btn">🗑️</button>
            `;

            main.style.padding = "1rem";
            main.style.background = "white";
            main.style.marginBottom = "1rem";
            main.style.borderRadius = "0.7rem";
            main.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
            
            const deleteBtn = main.querySelector(".delete-btn");
            deleteBtn.addEventListener("click", () => {
                main.remove();

                if (diaryList.children.length === 0) {
                    emptyMessage.style.display = "block";
                }

                updateStats();
            });

            container.appendChild(main);

            document.querySelector("input[type='text']").value = "";
            document.querySelector("select").value = "";
            document.querySelector("input[type='date']").valueAsDate = new Date();
            document.querySelector("textarea").value = "";
            selectedRating = 0;
            updateStarDisplay();
            updateStats();
        }

        document.getElementById("diary-form").addEventListener("submit", diary);

        const buttons = document.querySelectorAll("#btn-all .btn");

        buttons.forEach(button => {
            button.addEventListener("click", () => {
                const category = button.textContent;
                const diaryAll = document.querySelectorAll("#diary-list .fx3");

                buttons.forEach(btn => btn.classList.remove("frist"));
                button.classList.add("frist");

                diaryAll.forEach(data => {
                    const dataName = data.getAttribute("data-name");

                    if (category === "전체" || dataName === category) {
                        data.style.display = "flex";
                    } 
                    else {
                        data.style.display = "none";
                    }
                });
            });
        });

        function updateStats() {
            const diaryAll = document.querySelectorAll("#diary-list .fx3");
            const total = diaryAll.length;

            let totalScore = 0;
            let monthCount = 0;
            const genreCount = {};

            const today = new Date();
            const thisMonth = today.getMonth();
            const thisYear = today.getFullYear();

            diaryAll.forEach(item => {
                const text = item.innerText;
                const dateMatch = text.match(/\((\d{4}-\d{2}-\d{2})\)/);
                const stars = text.match(/★/g);
                const genre = item.getAttribute("data-name");

                if (dateMatch && stars) {
                    const writtenDate = new Date(dateMatch[1]);
                    totalScore += stars.length;

                    if (writtenDate.getFullYear() === thisYear && writtenDate.getMonth() === thisMonth) {
                        monthCount++;
                    }

                    if (genre) {
                        genreCount[genre] = (genreCount[genre] || 0) + 1;
                    }
                }
            });

            const avg = total ? (totalScore / total).toFixed(1) : "0.0";
            const favoriteGenre = Object.entries(genreCount).sort((a, b) => b[1] - a[1])[0]?.[0] || "-";

            document.querySelector(".page-box1 .page-box2:nth-child(1) .num").textContent = total;
            document.querySelector(".page-box1 .page-box2:nth-child(2) .num").textContent = avg;
            document.querySelector(".page-box1 .page-box2:nth-child(3) .num").textContent = monthCount;
            document.querySelector(".page-box1 .page-box2:nth-child(4) .num").textContent = favoriteGenre;
        }
    </script>
</body>
</html>