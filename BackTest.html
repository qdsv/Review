<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š ë‚˜ì˜ ì½˜í…ì¸  ë‹¤ì´ì–´ë¦¬</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }

        body{
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        #page-wrapper1{
            max-width: 53.7rem;
            margin: 1rem auto;
            padding: 0.6rem;
            background: white;
            border-radius: 1.2rem;
            box-shadow: 0px 2px 6px rgba(100, 100, 100, 0.3);
        }

        #page-wrapper2{
            max-width: 48rem;
            margin: 2rem auto;
            padding: 1.5rem;
            background: #f8f9fa;
            border: 0.17rem solid #e9ecef;
            border-radius: 1rem;
        }

        #page-wrapper3{
            max-width: 48rem;
            margin: 1.5rem auto;
            padding: 1.6rem;
            background: #e3f2fd;
            border: none;
            border-radius: 0.7rem;
        }

        h1{
            text-align: center;
            font-size: 2.5rem;
            margin-top: 1.5rem;
        }

        .fx{
            display: flex;
            align-items: center;
            gap: 1.7rem;
        }

        .fx2{
            display: flex;
            align-items: center;
        }

        .fx, .fx2{
            margin-bottom: 1rem;
        }

        .fx input, select, textarea{
            flex: 1;
            font-size: 1rem;
            padding: 0.8rem;
            border: 0.15rem solid #dee2e6;
            border-radius: 0.5rem;
        }

        #plus{
            font-size: 1rem;
            color: white;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 100%;
            margin-top: 0.9rem;
            border: none;
            padding: 0.8rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #plus:hover{
            transform: translateY(-2px);
            box-shadow: 0 0.01rem 1.5rem rgba(102, 126, 234, 0.4);
        }

        .page-box1{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            text-align: center;
        }

        .page-box2{
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.2rem 0.4rem rgba(0, 0, 0, 0.1);
        }

        .num{
            font-size: 2rem;
            font-weight: bold;
            color: #667eea
        }

        .num-text{
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        #btn-all{
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .btn.frist, .btn:hover{
            background-color: #667eea;
            color: white;
        }

        .btn{
            background-color: white;
            color: #667eea;
            border: 0.15rem solid #667eea;
            padding: 0.4rem 0.8rem;
            border-radius: 2rem;
            cursor: pointer;
            margin: 0 0.3rem;
            transition: all 0.3s ease;
        }

        .delete-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0.2rem 0.4rem;
            margin-left: 0.5rem;
        }

        #line{
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.7rem;
            border-bottom: 0.15rem solid #f0f0f0;
        }

        .star{
            cursor: pointer;
            font-size: 1.3rem;
        }

        .fx3{
                display: flex;
                justify-content: space-between;
            }

        @media (max-width: 768px) {
            #page-wrapper1,
            #page-wrapper2,
            #page-wrapper3 {
                width: 95%;
                max-width: none; 
                padding: 1rem;
                margin: 1rem auto;
                box-sizing: border-box;
            }

            h1 {
                font-size: 1.8rem;
            }

            .fx {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .fx input,
            .fx select,
            .fx textarea {
                width: 100%;
                box-sizing: border-box;
            }

            #btn-all .btn {
                margin-bottom: 0.5rem;
            }

            .page-box1 {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="page-wrapper1">
        <h1 style="color: #333;">ğŸ“š ë‚˜ì˜ ì½˜í…ì¸  ë‹¤ì´ì–´ë¦¬</h1>
        <div id="page-wrapper2">
            <form id="diary-form">
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">ì œëª©:</div> <input type="text" placeholder="ì˜í™”, ë“œë¼ë§ˆ, ì›¹íˆ° ,ì±… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">ì¢…ë¥˜:</div>
                    <select name="" id="" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="movie">ğŸ¬ ì˜í™”</option>
                        <option value="drama">ğŸ“º ë“œë¼ë§ˆ</option>
                        <option value="webtoon">ğŸ“± ì›¹íˆ°</option>
                        <option value="book">ğŸ“– ì±…</option>
                    </select>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">ë‚ ì§œ:</div> <input type="date" id="dt" required>
                </div>
                <div class="fx2">
                    <div style="margin-right: 3.7rem; font-weight: bold; color: #495057;">í‰ì :</div>
                    <div class="star-rating">
                        <span class="star" data-rating="1">â˜†</span>
                        <span class="star" data-rating="2">â˜†</span>
                        <span class="star" data-rating="3">â˜†</span>
                        <span class="star" data-rating="4">â˜†</span>
                        <span class="star" data-rating="5">â˜†</span>
                        <span id="rating-text">(í‰ì ì„ ì„ íƒí•˜ì„¸ìš”)</span>
                    </div>
                </div>
                <div class="fx">
                    <div style="margin-right: 2rem; font-weight: bold; color: #495057;">ë©”ëª¨:</div> <textarea name="" id="" placeholder="ê°ìƒí‰ì´ë‚˜ ê¸°ì–µí•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ì ì–´ë³´ì„¸ìš”..." style="height: 3rem;"></textarea>
                </div>
                <input type="submit" id="plus" value="ğŸ“ ë‹¤ì´ì–´ë¦¬ ì¶”ê°€í•˜ê¸°">
            </form>
        </div>
        <div id="page-wrapper3">
            <h3 style="text-align: center; margin-bottom: 1.2rem;">ğŸ“Š ë‚˜ì˜ ì½˜í…ì¸  í†µê³„</h3>
            <div class="page-box1">
                <div class="page-box2">
                    <div class="num">0</div>
                    <div class="num-text">ì´ ê°œìˆ˜</div>
                </div>
                <div class="page-box2">
                    <div class="num">0.0</div>
                    <div class="num-text">í‰ê·  í‰ì </div>
                </div>
                <div class="page-box2">
                    <div class="num">0</div>
                    <div class="num-text">ì´ë²ˆ ë‹¬</div>
                </div>
                <div class="page-box2">
                    <div class="num">-</div>
                    <div class="num-text">ìµœì•  ì¥ë¥´</div>
                </div>
            </div>
        </div>
        <div id="btn-all">
            <button class="btn frist">ì „ì²´</button>
            <button class="btn">ğŸ¬ ì˜í™”</button>
            <button class="btn">ğŸ“º ë“œë¼ë§ˆ</button>
            <button class="btn">ğŸ“± ì›¹íˆ°</button>
            <button class="btn">ğŸ“– ì±…</button>
        </div>
        <div style="margin-left: 1rem; margin-right: 1rem; margin-bottom: 1rem;">
            <h3 id="line">ğŸ“– ë‚´ê°€ ë³¸ ì½˜í…ì¸ ë“¤</h3>
            <div id="empty" style="text-align: center; font-size: 1rem;">
                <div style="font-size: 3rem;">ğŸ“</div>
                <p>ì•„ì§ ê¸°ë¡ëœ ì½˜í…ì¸ ê°€ ì—†ì–´ìš”!</p>
                <p>ìœ„ì—ì„œ ì²« ë²ˆì§¸ ë‹¤ì´ì–´ë¦¬ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš” ğŸ˜Š</p>
            </div>
            <div id="diary-list"></div>
        </div>
    </div>

   <script>
    // --- ê¸°ë³¸ ì„¤ì • ---
    // ë°±ì—”ë“œ ì„œë²„ì˜ API ê¸°ë³¸ ì£¼ì†Œë¥¼ ìƒìˆ˜ë¡œ ì €ì¥í•©ë‹ˆë‹¤.
    // ë‚˜ì¤‘ì— ì„œë²„ ì£¼ì†Œê°€ ë°”ë€Œë©´ ì´ ë¶€ë¶„ë§Œ ìˆ˜ì •í•˜ë©´ ë˜ì–´ì„œ í¸ë¦¬í•©ë‹ˆë‹¤.
    const API_URL = 'http://localhost:3000/api/diaries';

    // í˜ì´ì§€ê°€ ì²˜ìŒ ë¡œë“œë  ë•Œ ë‚ ì§œ ì…ë ¥ì°½ì˜ ê¸°ë³¸ê°’ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    document.getElementById("dt").valueAsDate = new Date();
    
    // ì‚¬ìš©ìê°€ í´ë¦­í•œ ë³„ì (rating)ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë³€ìˆ˜ì…ë‹ˆë‹¤.
    // ì•„ë¬´ê²ƒë„ ì„ íƒí•˜ì§€ ì•Šì•˜ì„ ë•Œì˜ ê¸°ë³¸ê°’ì€ 0ì…ë‹ˆë‹¤.
    let selectedRating = 0;

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
    // 'DOMContentLoaded'ëŠ” ì›¹ ë¸Œë¼ìš°ì €ê°€ HTML ë¬¸ì„œë¥¼ ì „ë¶€ ì½ê³ è§£æí•œ í›„ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.
    // ì¦‰, í˜ì´ì§€ê°€ ì¤€ë¹„ë˜ìë§ˆì fetchDiaries í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì„œ ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    document.addEventListener('DOMContentLoaded', fetchDiaries);

    // 'diary-form'ì´ë¼ëŠ” idë¥¼ ê°€ì§„ í¼(form)ì—ì„œ 'submit' ì´ë²¤íŠ¸(ì¶”ê°€í•˜ê¸° ë²„íŠ¼ í´ë¦­)ê°€ ë°œìƒí–ˆì„ ë•Œ,
    // handleFormSubmit í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì—°ê²°í•©ë‹ˆë‹¤.
    document.getElementById("diary-form").addEventListener("submit", handleFormSubmit);

    // ë³„ì (star)ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  span íƒœê·¸ë“¤ì„ ì°¾ì•„ì„œ ê°ê° í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    document.querySelectorAll(".star").forEach(star => {
        star.addEventListener("click", function () {
            // í´ë¦­ëœ ë³„ì˜ data-rating ê°’ì„ ê°€ì ¸ì™€ì„œ selectedRating ë³€ìˆ˜ì— ì €ì¥í•©ë‹ˆë‹¤.
            selectedRating = parseInt(this.dataset.rating);
            // í™”ë©´ì— ë³´ì´ëŠ” ë³„ ëª¨ì–‘ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (ì˜ˆ: 3ì ì„ ëˆ„ë¥´ë©´ ë³„ 3ê°œê°€ ì±„ì›Œì§)
            updateStarDisplay();
        });
    });

    // --- í•¨ìˆ˜ ì •ì˜ ---

    // 1. ì„œë²„ì—ì„œ ëª¨ë“  ë‹¤ì´ì–´ë¦¬ ê¸°ë¡ì„ ê°€ì ¸ì™€ì„œ í™”ë©´ì— ê·¸ë¦¬ëŠ” í•¨ìˆ˜
    async function fetchDiaries() {
        try {
            // fetch í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ API_URLì— GET ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
            // awaitëŠ” ì„œë²„ì˜ ì‘ë‹µì´ ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê²Œ í•©ë‹ˆë‹¤.
            const response = await fetch(API_URL);
            // ì„œë²„ê°€ ë³´ë‚¸ JSON í˜•ì‹ì˜ ì‘ë‹µ ë°ì´í„°ë¥¼ ì‹¤ì œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ ë°°ì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
            const diaries = await response.json();

            const diaryList = document.getElementById("diary-list");
            const emptyMessage = document.getElementById("empty");
            
            // ìƒˆë¡œìš´ ëª©ë¡ì„ ê·¸ë¦¬ê¸° ì „ì— ê¸°ì¡´ì— ìˆë˜ ëª©ë¡ì„ ê¹¨ë—í•˜ê²Œ ë¹„ì›ë‹ˆë‹¤.
            diaryList.innerHTML = ''; 

            if (diaries.length === 0) {
                // ë°›ì•„ì˜¨ ë°ì´í„°ê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ "ê¸°ë¡ëœ ì½˜í…ì¸ ê°€ ì—†ì–´ìš”!" ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
                emptyMessage.style.display = "block";
            } else {
                // ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë©”ì‹œì§€ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
                emptyMessage.style.display = "none";
                // diaries ë°°ì—´ì˜ ê° í•­ëª©(diary)ì— ëŒ€í•´ ë°˜ë³µ ì‹¤í–‰í•©ë‹ˆë‹¤.
                diaries.forEach(diary => {
                    // ê° ë‹¤ì´ì–´ë¦¬ ë°ì´í„°ë¡œ HTML ìš”ì†Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                    const diaryElement = createDiaryElement(diary);
                    // ìƒì„±ëœ HTML ìš”ì†Œë¥¼ í™”ë©´ì˜ ëª©ë¡(diaryList)ì— ì¶”ê°€í•©ë‹ˆë‹¤.
                    diaryList.appendChild(diaryElement);
                });
            }
            // ëª©ë¡ì„ ê·¸ë¦° í›„, í†µê³„ë¥¼ ë‹¤ì‹œ ê³„ì‚°í•´ì„œ í™”ë©´ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            updateStats(diaries);
        } catch (error) {
            // fetch ê³¼ì •ì—ì„œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“±ì´ ë°œìƒí•˜ë©´ ì½˜ì†”ì— ì—ëŸ¬ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.
            console.error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        }
    }

    // 2. í¼ ì œì¶œ(ë‹¤ì´ì–´ë¦¬ ì¶”ê°€) ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
    async function handleFormSubmit(e) {
        // e.preventDefault()ëŠ” í¼ ì œì¶œ ì‹œ ë°œìƒí•˜ëŠ” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í˜„ìƒì„ ë§‰ìŠµë‹ˆë‹¤.
        e.preventDefault();

        // í¼ ì…ë ¥ ìš”ì†Œë“¤ë¡œë¶€í„° ê°’ì„ ì½ì–´ì™€ì„œ ì„œë²„ë¡œ ë³´ë‚¼ ê°ì²´(newDiary)ë¥¼ ë§Œë“­ë‹ˆë‹¤.
        const newDiary = {
            title: document.querySelector("input[type='text']").value,
            type: document.querySelector("select").options[
                document.querySelector("select").selectedIndex
            ].text,
            date: document.querySelector("input[type='date']").value,
            rating: selectedRating,
            memo: document.querySelector("textarea").value
        };

        // í•„ìˆ˜ í•­ëª©ë“¤ì´ ëª¨ë‘ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        if (!newDiary.title || !newDiary.type || !newDiary.date || newDiary.rating === 0) {
            alert("ì œëª©, ì¢…ë¥˜, ë‚ ì§œ, í‰ì ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return; // í•¨ìˆ˜ ì‹¤í–‰ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.
        }

        try {
            // API_URLì— POST ë°©ì‹ìœ¼ë¡œ newDiary ê°ì²´ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
            await fetch(API_URL, {
                method: 'POST', // ìš”ì²­ ë°©ì‹ì€ POST
                headers: { 'Content-Type': 'application/json' }, // ë³´ë‚´ëŠ” ë°ì´í„°ì˜ í˜•ì‹ì€ JSON
                body: JSON.stringify(newDiary) // ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
            });
            // ë°ì´í„° ì €ì¥ì´ ì„±ê³µí•˜ë©´, ëª©ë¡ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ í™”ë©´ì„ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            fetchDiaries();
            // ì…ë ¥ í¼ì˜ ë‚´ìš©ì„ ëª¨ë‘ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            resetForm();
        } catch (error) {
            console.error('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        }
    }

    // 3. ë‹¤ì´ì–´ë¦¬ ë°ì´í„° í•˜ë‚˜ë¥¼ ë°›ì•„ HTML ìš”ì†Œë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    function createDiaryElement(diary) {
        const main = document.createElement("div");
        main.className = "fx3";
        // diary ê°ì²´ì˜ ì •ë³´ë¥¼ ì‚¬ìš©í•´ innerHTMLë¡œ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ë§Œë“­ë‹ˆë‹¤.
        // toLocaleDateString()ì€ ë‚ ì§œ í˜•ì‹ì„ 'YYYY. MM. DD.'ì™€ ê°™ì´ ë³´ê¸° ì¢‹ê²Œ ë°”ê¿”ì¤ë‹ˆë‹¤.
        main.innerHTML = `
            <div>
                <strong>${diary.type}</strong> ${diary.title} (${new Date(diary.date).toLocaleDateString()})<br>
                í‰ì : ${"â˜…".repeat(diary.rating)}${"â˜†".repeat(5 - diary.rating)}<br>
                ë©”ëª¨: ${diary.memo || "(ì—†ìŒ)"}
            </div>
            <button class="delete-btn">ğŸ—‘ï¸</button>
        `;
        
        // ë°©ê¸ˆ ë§Œë“  ìš”ì†Œ ì•ˆì—ì„œ ì‚­ì œ ë²„íŠ¼ì„ ì°¾ì•„ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
        main.querySelector(".delete-btn").addEventListener("click", async () => {
            if (confirm('ì •ë§ë¡œ ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ì‚­ì œ API ì£¼ì†Œ(${API_URL}/${diary._id})ì— DELETE ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
                    // diary._idëŠ” MongoDBê°€ ê° ë°ì´í„°ì— ë¶€ì—¬í•œ ê³ ìœ  IDì…ë‹ˆë‹¤.
                    await fetch(`${API_URL}/${diary._id}`, { method: 'DELETE' });
                    // ì‚­ì œ ì„±ê³µ í›„, ëª©ë¡ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                    fetchDiaries();
                } catch (error) {
                    console.error('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
            }
        });

        main.style.padding = "1rem";
        main.style.background = "white";
        // ... (ì´í•˜ ìŠ¤íƒ€ì¼ë§ ì½”ë“œ)
        
        return main; // ì™„ì„±ëœ HTML ìš”ì†Œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    }

    // 4. ì…ë ¥ í¼ì„ ì´ˆê¸°í™”í•˜ëŠ” í•¨ìˆ˜
    function resetForm() {
        document.querySelector("input[type='text']").value = "";
        document.querySelector("select").value = "";
        document.querySelector("input[type='date']").valueAsDate = new Date();
        document.querySelector("textarea").value = "";
        selectedRating = 0;
        updateStarDisplay();
    }
    
    // (ê¸°ì¡´ í•¨ìˆ˜ë“¤: updateStarDisplay, updateStats)
    // ë³„ì  í‘œì‹œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateStarDisplay() {
        // ...
    }

    // í†µê³„ ì •ë³´ë¥¼ ê³„ì‚°í•˜ê³  ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
    function updateStats(diaries) {
        // ...
    }
</script>
</body>
</html>
